<dmx-serverconnect id="serverconnect2" url="/api/external/connection/get_connections"></dmx-serverconnect>
<dmx-data-detail id="data_detail1" dmx-bind:data="serverconnect1.data.query" key="message_id"></dmx-data-detail>
<dmx-serverconnect id="serverconnect1" url="/api/messages/getMessages"></dmx-serverconnect>
<!-- Wappler include head-page="layouts/main" is="dmx-app" id="messages" appConnect="local" jquery_slim_35="local" fontawesome_4="local" bootstrap4="cerulean" bootstrap_icons="cdn" components="{dmxDataTraversal:{},dmxBootstrap4TableGenerator:{},dmxBootstrap4Modal:{}}" -->




<body is="dmx-app" id="index">
  <div class="container-fluid mb-5">
    <div class="modal" id="modal2" is="dmx-bs4-modal" tabindex="-1" role="dialog">
      <div class="modal-dialog" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">Enviar mensagem</h5>
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <div class="modal-body">
            <form id="form1" method="post" is="dmx-serverconnect-form" action="/api/external/messages/send_message" dmx-on:success="modal2.hide();serverconnect1.load({},true)">
              <div class="form-group row">
                <label for="inp_messageID1" class="col-sm-2 col-form-label col-form-label-sm">Destinat√°rio</label>
                <div class="col-sm-10">
                  <select id="conn_id" class="form-control" dmx-bind:options="serverconnect2.data.api.data.results" optiontext="their_label" optionvalue="connection_id" name="conn_id">
                  </select>
                </div>

              </div>
              <div class="form-group row">
                <label for="inp_messageID1" class="col-sm-2 col-form-label col-form-label-sm">Mensagem</label>
                <div class="col-sm-10">
                  <textarea id="message" class="form-control" name="message"></textarea>
                </div>

              </div>
            </form>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-primary btn-sm" dmx-on:click="modal2.form1.submit()">Enviar&nbsp;<i class="bi-arrow-clockwise"></i></button>
          </div>
        </div>
      </div>
    </div>
    <div class="modal" id="modal1" is="dmx-bs4-modal" tabindex="-1" role="dialog">
      <div class="modal-dialog" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">Mensagem</h5>
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <div class="modal-body">
            <div class="row">
            </div>
            <form is="dmx-serverconnect-form" id="serverconnectform1" method="post" action="/api/messages/modMessages" dmx-generator="bootstrap4" dmx-form-type="horizontal" dmx-populate="data_detail1.data">

              <div class="form-group row">
                <label for="inp_from" class="col-sm-2 col-form-label" dmx-text="'MessageID : '+data_detail1.data.message_id">From</label>


              </div>

              <div class="form-group row">

                <label for="inp_from" class="col-sm-2 col-form-label">From</label>
                <div class="col-sm-10">
                  <input type="text" class="form-control" id="inp_from" name="from" dmx-bind:value="data_detail1.data.from" aria-describedby="inp_from_help" placeholder="Enter From">
                </div>

              </div>
              <div class="form-group row">
                <label for="inp_msg" class="col-sm-2 col-form-label">Msg</label>
                <div class="col-sm-10">
                  <input type="text" class="form-control" id="inp_msg" name="msg" dmx-bind:value="data_detail1.data.msg" aria-describedby="inp_msg_help" placeholder="Enter Msg">
                </div>
              </div>
              <div class="form-group row">
                <label for="inp_date" class="col-sm-2 col-form-label">Date</label>
                <div class="col-sm-10">
                  <input type="text" class="form-control" id="inp_date" name="date" dmx-bind:value="data_detail1.data.date" aria-describedby="inp_date_help" placeholder="Enter Date">
                </div>
              </div>
              <div class="form-group row">
                <label for="inp_id" class="col-sm-2 col-form-label">Id</label>
                <div class="col-sm-10">
                  <input type="number" class="form-control" id="inp_id" name="id" dmx-bind:value="data_detail1.data.id" aria-describedby="inp_id_help" placeholder="Enter Id">
                </div>
              </div>
              <div class="form-group row">
                <label for="inp_operator" class="col-sm-2 col-form-label">Operator</label>
                <div class="col-sm-10">
                  <input type="text" class="form-control" id="inp_operator" name="operator" dmx-bind:value="data_detail1.data.operator" aria-describedby="inp_operator_help" placeholder="Enter Operator">
                </div>
              </div>
            </form>

          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-dismiss="modal"></button>
          </div>
        </div>
      </div>
    </div>






    <h5 class="text-center h-auto mt-4 pt-5"><i class="bi-chat-right-text"></i>&nbsp;Mensagens</h5><button id="btn1" class="btn font-weight-bold btn-sm btn-primary" dmx-on:click="modal2.show()" style="cursor: pointer;">Nova
      mensagem&nbsp;<i class="fa fa-envelope"></i></button>
    <div class="table-responsive">
      <table class="table table-striped table-bordered table-hover table-sm">
        <thead>
          <tr>
            <th class="text-center small font-weight-bold">Message ID</th>
            <th class="text-center small font-weight-bold">From</th>
            <th class="text-center small font-weight-bold">To</th>
            <th class="text-center small font-weight-bold">Date</th>
          </tr>
        </thead>
        <tbody is="dmx-repeat" dmx-generator="bs4table" dmx-bind:repeat="serverconnect1.data.query" id="tableRepeat1">
          <tr class="small" dmx-on:click="data_detail1.select(message_id);modal1.show()">
            <td dmx-text="message_id" class="text-center"></td>
            <td dmx-text="from" class="text-center"></td>
            <td dmx-text="to" class="text-center"></td>
            <td dmx-text="date" class="text-center"></td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>

  <script src="bootstrap/4/js/popper.min.js"></script>
  <script src="bootstrap/4/js/bootstrap.min.js"></script>
</body>